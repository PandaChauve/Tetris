function Game(a,b,c){this.config=a;this.grid=b;this.tetris=[];this.visual=[];this.kb=new UserInput;this.stateChecker=new StateChecker(a.victory);this.tobefixed=[2,2];this.stop=!1;this.id=-1;this.start=null;this.pause=!1;this.tics=0;this.stats=new GameStats;this.stats.gameCount+=1;this.callback=void 0===c?null:c;this.Init()}Game.prototype.Stop=function(){window.cancelAnimationFrame(this.id);this.stop=!0;for(var a=0;a<this.visual.length;a+=1)this.visual[a].clear(),this.visual[a]=null};
Game.CreateRenderingFct=function(a){return function(b){a.render(b)}};Game.prototype.Start=function(){this.id=requestAnimationFrame(Game.CreateRenderingFct(this))};
Game.prototype.Init=function(){for(var a=0;a<this.config.tetris.length;a+=1){this.tetris.push(new Tetris(this.grid,this.config.tetris[a].cursors,this.stats));for(var b=0;b<this.config.tetris[a].mappings.length;b+=1)this.tetris[a].keyBoardMappings.push(UserInput[this.config.tetris[a].mappings[b]]);this.visual.push(new ThreeRenderer(this.config.tetris[a].cursors));this.visual[a].LinkDom(this.config.tetris[a].gameBox);this.visual[a].RenderTetris(this.tetris[a])}};
Game.prototype.SplitScreenQuickFix=function(){if(2===this.tetris.length){for(;this.tobefixed[0]<this.tetris[1].GetScore()/3;)this.tobefixed[0]+=1,this.tetris[0].RandomFall();for(;this.tobefixed[1]<this.tetris[0].GetScore()/3;)this.tobefixed[1]+=1,this.tetris[1].RandomFall()}};
Game.prototype.TogglePause=function(a){if(this.stop)return!1;(this.pause=void 0===a?!this.pause:a)?window.cancelAnimationFrame(this.id):(this.id=requestAnimationFrame(Game.CreateRenderingFct(this)),this.start=null);this.kb.clear();return this.pause};
Game.prototype.render=function(a){null===this.start&&(this.start=a-this.tics/TIC_PER_SEC*1E3);var b=a-this.start;$(".timeBox").html(TimeFromTics(this.tics));for(var c=!0,d=0;this.tics<b*TIC_PER_SEC/1E3&&c&&10>d;){d+=1;this.tics+=1;for(a=0;a<this.tetris.length;a+=1)this.tetris[a].OneTick(this.kb),$("#"+this.config.tetris[a].scoreBox).html(this.tetris[a].GetScore()),this.stateChecker.Check(this.tetris[a]),this.stateChecker.Defeat()||this.stateChecker.Victory()?(c=!1,this.visual[a].Freeze()):void 0!==
this.config.victory&&void 0!==this.config.victory.swaps?$("#"+this.config.tetris[a].swapBox).html(this.config.victory.swaps-this.tetris[a].GetSwaps()):$("#"+this.config.tetris[a].swapBox).html(this.tetris[a].GetSwaps());this.kb.clear()}if(c&&!this.stop){for(a=0;a<this.tetris.length;a+=1)this.visual[a].RenderTetris(this.tetris[a]);this.SplitScreenQuickFix();this.id=requestAnimationFrame(Game.CreateRenderingFct(this))}else c||null!==this.callback&&this.callback(this)};
