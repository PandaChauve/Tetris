var gameController=angular.module("angularApp.controllers");
gameController.controller("GameCtrl",["$scope","$http","$route","$routeParams","$modal","$window",function(a,d,e,f,g,h){a.gameName=f.name||"classic";a.confi={};a.game=null;a.confi.splitScreen="classicSplitScreen"===a.gameName;a.load=function(){d.get("games/"+a.gameName+".json",{cache:!1}).success(function(b){a.useGameConfig(b)}).error(function(a){console.log(a)})};a.load();a.pause={toggle:function(){a.pause.active=a.game.TogglePause()},active:!1};a.$on("$routeChangeStart",function(){a.game&&(a.game.Stop(),
a.game=null)});a.reset=function(){a.game.Stop();a.game=new Game(a.game.config,a.game.grid,a.endCallBack);a.game.Start()};angular.element(h).bind("blur",function(){return function(){a.game&&(a.pause.active=!0,a.game.TogglePause(!0),a.$apply())}}());a.useGameConfig=function(b){CONFIG=GetConfig(b.config);""==b.grid?(a.game=new Game(b,"",a.endCallBack),a.game.Start()):d.get("grids/"+b.grid+".json",{cache:!1}).success(function(c){a.game=new Game(b,c,a.endCallBack);a.game.Start()}).error(function(a){console.log(a)})};
a.endCallBack=function(b){b.stats.SetTime(b.tics);b.stats.SetSwaps(b.tetris[0].swapCount);var c=UserStats.GetUserStats();c.AddGame(b.stats,a.gameName);(new AchievementsState).check(b.stats,c,a.gameName);a.open(b.stateChecker.lastSuccessCheck,b.stats)};a.open=function(b,c){g.open({animation:!0,templateUrl:"templates/modal.html",controller:"ModalInstanceCtrl",size:300,resolve:{won:function(){return b},gameName:function(){return a.gameName},statistics:function(){return c}}}).result.then(function(){b&&
a.game.config.next?(a.gameName=a.game.config.next,e.updateParams({name:a.gameName}),a.load()):a.reset()},function(){})}}]);
