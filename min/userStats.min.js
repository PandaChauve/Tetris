angular.module("angularApp.factories").factory("userStats",["storage","gameStatsFactory",function(a,b){"use strict";function c(){this.points={},this.bestGameStats={},this.totalGameStats={},this.currentGame=b.newGameStats()}return c.prototype.getCurrentGame=function(){return this.currentGame},c.prototype.setMaxStat=function(b,c,d){if(this[d].hasOwnProperty(c)){for(var e=0;e<this[d][c].length;e+=1)if(b>=this[d][c][e]){this[d][c].splice(e,0,b),this[d][c].splice(this[d][c].length-1,1);break}}else this[d][c]=[b,0,0,0,0];a.Set("UserStats_"+d,this[d])},c.prototype.setMinStat=function(b,c,d){if(this[d].hasOwnProperty(c)){for(var e=0;e<this[d][c].length;e+=1)if(b<=this[d][c][e]||-1===this[d][c][e]){this[d][c].splice(e,0,b),this[d][c].splice(this[d][c].length-1,1);break}}else this[d][c]=[b,-1,-1,-1,-1];a.Set("UserStats_"+d,this[d])},c.prototype.addGame=function(b,c){this.bestGameStats.hasOwnProperty(c)?this.bestGameStats[c].keepBest(b):this.bestGameStats[c]=b,a.Set("UserStats_bestGameStats",this.bestGameStats),this.totalGameStats.hasOwnProperty(c)?this.totalGameStats[c].append(b):this.totalGameStats[c]=b,a.Set("UserStats_totalGameStats",this.totalGameStats),this.setMaxStat(b.score,c,"points")},c.prototype.getBestGameStats=function(a){return this.bestGameStats.hasOwnProperty(a)?this.bestGameStats[a]:b.newGameStats()},c.prototype.getTotalGameStats=function(a){return this.totalGameStats.hasOwnProperty(a)?this.totalGameStats[a]:b.newGameStats()},c.prototype.getHighScore=function(a){return this.points.hasOwnProperty(a)?this.points[a]:[0,0,0,0,0]},c.GetUserStats=function(){var d=a.Get("UserStats_points"),e=a.Get("UserStats_bestGameStats"),f=a.Get("UserStats_totalGameStats"),g=new c;if(null!==d&&(g.points=d),null!==e)for(var h in e)e.hasOwnProperty(h)&&(g.bestGameStats[h]=b.newGameStatsFrom(e[h]));if(null!==f)for(h in f)f.hasOwnProperty(h)&&(g.totalGameStats[h]=b.newGameStatsFrom(f[h]));return g},c.GetUserStats()}]);