function Grid(a){"use strict";var b,c,d=0!==CONFIG.groundUpSpeedPerTic||0!==CONFIG.groundSpeedPerTic;for(this.container=new Array(CONFIG.columnCount),b=0;b<CONFIG.columnCount;b+=1)for(this.container[b]=new Array(CONFIG.hiddenRowCount),c=0;c<this.container[b].length;c+=1)this.container[b][c]=new Block,this.container[b][c].verticalPosition=c*CONFIG.pixelPerBox,d||(this.container[b][c].type=Block.EType.PlaceHolder,this.container[b][c].state=Block.EState.Blocked);if(void 0===a||""===a)for(b=0;b<CONFIG.columnCount;b+=1)for(c=this.container[b].length;c<CONFIG.startRows;c+=1)this.container[b].push(new Block),this.container[b][c].verticalPosition=c*CONFIG.pixelPerBox;else this.Load(a)}function Grid(a){"use strict";var b,c,d=0!==CONFIG.groundUpSpeedPerTic||0!==CONFIG.groundSpeedPerTic;for(this.container=new Array(CONFIG.columnCount),b=0;b<CONFIG.columnCount;b+=1)for(this.container[b]=new Array(CONFIG.hiddenRowCount),c=0;c<this.container[b].length;c+=1)this.container[b][c]=new Block,this.container[b][c].verticalPosition=c*CONFIG.pixelPerBox,d||(this.container[b][c].type=Block.EType.PlaceHolder,this.container[b][c].state=Block.EState.Blocked);if(void 0===a||""===a)for(b=0;b<CONFIG.columnCount;b+=1)for(c=this.container[b].length;c<CONFIG.startRows;c+=1)this.container[b].push(new Block),this.container[b][c].verticalPosition=c*CONFIG.pixelPerBox;else this.Load(a)}function Grid(a){"use strict";var b,c,d=0!==CONFIG.groundUpSpeedPerTic||0!==CONFIG.groundSpeedPerTic;for(this.container=new Array(CONFIG.columnCount),b=0;b<CONFIG.columnCount;b+=1)for(this.container[b]=new Array(CONFIG.hiddenRowCount),c=0;c<this.container[b].length;c+=1)this.container[b][c]=new Block,this.container[b][c].verticalPosition=c*CONFIG.pixelPerBox,d||(this.container[b][c].type=Block.EType.PlaceHolder,this.container[b][c].state=Block.EState.Blocked);if(void 0===a||""===a)for(b=0;b<CONFIG.columnCount;b+=1)for(c=this.container[b].length;c<CONFIG.startRows;c+=1)this.container[b].push(new Block),this.container[b][c].verticalPosition=c*CONFIG.pixelPerBox;else this.Load(a)}function Grid(a){"use strict";var b,c,d=0!==CONFIG.groundUpSpeedPerTic||0!==CONFIG.groundSpeedPerTic;for(this.container=new Array(CONFIG.columnCount),b=0;b<CONFIG.columnCount;b+=1)for(this.container[b]=new Array(CONFIG.hiddenRowCount),c=0;c<this.container[b].length;c+=1)this.container[b][c]=new Block,this.container[b][c].verticalPosition=c*CONFIG.pixelPerBox,d||(this.container[b][c].type=Block.EType.PlaceHolder,this.container[b][c].state=Block.EState.Blocked);if(void 0===a||""===a)for(b=0;b<CONFIG.columnCount;b+=1)for(c=this.container[b].length;c<CONFIG.startRows;c+=1)this.container[b].push(new Block),this.container[b][c].verticalPosition=c*CONFIG.pixelPerBox;else this.Load(a)}function Grid(a){"use strict";var b,c,d=0!==CONFIG.groundUpSpeedPerTic||0!==CONFIG.groundSpeedPerTic;for(this.container=new Array(CONFIG.columnCount),b=0;b<CONFIG.columnCount;b+=1)for(this.container[b]=new Array(CONFIG.hiddenRowCount),c=0;c<this.container[b].length;c+=1)this.container[b][c]=new Block,this.container[b][c].verticalPosition=c*CONFIG.pixelPerBox,d||(this.container[b][c].type=Block.EType.PlaceHolder,this.container[b][c].state=Block.EState.Blocked);if(void 0===a||""===a)for(b=0;b<CONFIG.columnCount;b+=1)for(c=this.container[b].length;c<CONFIG.startRows;c+=1)this.container[b].push(new Block),this.container[b][c].verticalPosition=c*CONFIG.pixelPerBox;else this.Load(a)}function Grid(a){"use strict";var b,c,d=0!==CONFIG.groundUpSpeedPerTic||0!==CONFIG.groundSpeedPerTic;for(this.container=new Array(CONFIG.columnCount),b=0;b<CONFIG.columnCount;b+=1)for(this.container[b]=new Array(CONFIG.hiddenRowCount),c=0;c<this.container[b].length;c+=1)this.container[b][c]=new Block,this.container[b][c].verticalPosition=c*CONFIG.pixelPerBox,d||(this.container[b][c].type=Block.EType.PlaceHolder,this.container[b][c].state=Block.EState.Blocked);if(void 0===a||""===a)for(b=0;b<CONFIG.columnCount;b+=1)for(c=this.container[b].length;c<CONFIG.startRows;c+=1)this.container[b].push(new Block),this.container[b][c].verticalPosition=c*CONFIG.pixelPerBox;else this.Load(a)}function Grid(a){"use strict";var b,c,d=0!==CONFIG.groundUpSpeedPerTic||0!==CONFIG.groundSpeedPerTic;for(this.container=new Array(CONFIG.columnCount),b=0;b<CONFIG.columnCount;b+=1)for(this.container[b]=new Array(CONFIG.hiddenRowCount),c=0;c<this.container[b].length;c+=1)this.container[b][c]=new Block,this.container[b][c].verticalPosition=c*CONFIG.pixelPerBox,d||(this.container[b][c].type=Block.EType.PlaceHolder,this.container[b][c].state=Block.EState.Blocked);if(void 0===a||""===a)for(b=0;b<CONFIG.columnCount;b+=1)for(c=this.container[b].length;c<CONFIG.startRows;c+=1)this.container[b].push(new Block),this.container[b][c].verticalPosition=c*CONFIG.pixelPerBox;else this.Load(a)}function Grid(a){"use strict";var b,c,d=0!==CONFIG.groundUpSpeedPerTic||0!==CONFIG.groundSpeedPerTic;for(this.container=new Array(CONFIG.columnCount),b=0;b<CONFIG.columnCount;b+=1)for(this.container[b]=new Array(CONFIG.hiddenRowCount),c=0;c<this.container[b].length;c+=1)this.container[b][c]=new Block,this.container[b][c].verticalPosition=c*CONFIG.pixelPerBox,d||(this.container[b][c].type=Block.EType.PlaceHolder,this.container[b][c].state=Block.EState.Blocked);if(void 0===a||""===a)for(b=0;b<CONFIG.columnCount;b+=1)for(c=this.container[b].length;c<CONFIG.startRows;c+=1)this.container[b].push(new Block),this.container[b][c].verticalPosition=c*CONFIG.pixelPerBox;else this.Load(a)}function Grid(a){"use strict";var b,c,d=0!==CONFIG.groundUpSpeedPerTic||0!==CONFIG.groundSpeedPerTic;for(this.container=new Array(CONFIG.columnCount),b=0;b<CONFIG.columnCount;b+=1)for(this.container[b]=new Array(CONFIG.hiddenRowCount),c=0;c<this.container[b].length;c+=1)this.container[b][c]=new Block,this.container[b][c].verticalPosition=c*CONFIG.pixelPerBox,d||(this.container[b][c].type=Block.EType.PlaceHolder,this.container[b][c].state=Block.EState.Blocked);if(void 0===a||""===a)for(b=0;b<CONFIG.columnCount;b+=1)for(c=this.container[b].length;c<CONFIG.startRows;c+=1)this.container[b].push(new Block),this.container[b][c].verticalPosition=c*CONFIG.pixelPerBox;else this.Load(a)}Grid.prototype.AddNewLine=function(){"use strict";var a,b;for(a=0;a<CONFIG.columnCount;a+=1){for(b=0;b<this.container[a].length;b+=1)this.container[a][b].verticalPosition+=CONFIG.pixelPerBox;this.container[a].unshift(new Block)}},Grid.prototype.RemoveBlockFixed=function(a,b){"use strict";var c=this.container[a][b];return this.container[a].splice(b,1),this.MakeTopBlockFall(a,b),c},Grid.prototype.RemoveBlock=function(a,b){"use strict";var c=this.FindBlockIndex(a,b);if(-1===c)throw"Not my day";return this.RemoveBlockFixed(a,c)},Grid.prototype.InsertBlock=function(a,b){"use strict";for(var c=0;c<this.container[b].length;c+=1)if(this.container[b][c].verticalPosition>a.verticalPosition)return void this.container[b].splice(c,0,a);this.container[b].push(a)},Grid.prototype.FindBlock=function(a,b){"use strict";var c=this.FindBlockIndex(a,b);return-1===c?null:this.container[a][c]},Grid.prototype.FindBlockIndex=function(a,b){"use strict";var c;for(c in this.container[a])if(this.container[a].hasOwnProperty(c)&&this.container[a][c].verticalPosition===CONFIG.pixelPerBox*b)return parseInt(c);return-1},Grid.prototype.IsBlockIndexFree=function(a,b){"use strict";var c;for(c in this.container[a])if(this.container[a].hasOwnProperty(c)&&this.container[a][c].verticalPosition>=CONFIG.pixelPerBox*b&&this.container[a][c].verticalPosition<CONFIG.pixelPerBox*(b+1))return!1;return!0},Grid.prototype.MakeTopBlockFall=function(a,b){"use strict";if(0>b)throw"Not my day";for(var c=b;c<this.container[a].length&&this.container[a][c].state===Block.EState.Blocked;c+=1)this.container[a][c].SetState(Block.EState.Falling)},Grid.prototype.AnimateBlockFall=function(a,b,c,d){"use strict";return c.verticalPosition-=CONFIG.fallSpeedPerTic,c.verticalPosition<d&&(c.verticalPosition=d,this.container[a][b-1].state!==Block.EState.Falling&&c.SetState(Block.EState.Blocked)),{min:c.verticalPosition+CONFIG.pixelPerBox,deltaY:0}},Grid.prototype.AnimateBlockDisappear=function(a,b,c,d){"use strict";return c.animationState+=CONFIG.disapearSpeedPerTic,c.animationState>100&&-1===c.id?(this.container[a].splice(b,1),this.MakeTopBlockFall(a,b),{min:d,deltaY:-1}):{min:c.verticalPosition+CONFIG.pixelPerBox,deltaY:0}},Grid.prototype.AnimateSwapped=function(a,b,c,d){"use strict";if(c.animationState+=15,c.animationState>100){if(c.type===Block.EType.PlaceHolder)return this.RemoveBlockFixed(a,b),{min:d,deltaY:-1};this.container[a][b-1].state===Block.EState.Falling||this.container[a][b-1].verticalPosition<c.verticalPosition-CONFIG.pixelPerBox?(c.SetState(Block.EState.Falling),this.MakeTopBlockFall(a,b+1)):c.SetState(Block.EState.Blocked)}return{min:c.verticalPosition+CONFIG.pixelPerBox,deltaY:0}},Grid.prototype.AnimateBlock=function(a,b,c){"use strict";var d=this.container[a][b];switch(d.state){case Block.EState.Blocked:return{min:d.verticalPosition+CONFIG.pixelPerBox,deltaY:0};case Block.EState.Disappearing:return this.AnimateBlockDisappear(a,b,d,c);case Block.EState.Falling:return this.AnimateBlockFall(a,b,d,c);case Block.EState.SwappedRight:case Block.EState.SwappedLeft:return this.AnimateSwapped(a,b,d,c)}throw"Unsupported animation"},Grid.prototype.AnimateColumn=function(a){"use strict";var b,c,d;for(c=CONFIG.hiddenRowCount*CONFIG.pixelPerBox,b=CONFIG.hiddenRowCount;b<this.container[a].length;b+=1)d=this.AnimateBlock(a,b,c),c=d.min,b+=d.deltaY},Grid.prototype.Animate=function(){"use strict";for(var a=0;a<CONFIG.columnCount;a+=1)this.AnimateColumn(a)},Grid.prototype.GetMaxFixed=function(){"use strict";var a,b,c=0;for(a=0;a<CONFIG.columnCount;a+=1)for(b=CONFIG.hiddenRowCount;b<this.container[a].length&&this.container[a][b].state===Block.EState.Blocked;b+=1)this.container[a][b].verticalPosition>c&&(c=this.container[a][b].verticalPosition);return c},Grid.prototype.NewBlockFall=function(a){"use strict";var b=new Block;b.SetState(Block.EState.Falling),b.verticalPosition=(CONFIG.hiddenRowCount+CONFIG.displayedRowCount+1)*CONFIG.pixelPerBox,this.container[a].push(b)},Grid.prototype.Swap=function(a,b){"use strict";var c=this.FindBlock(a,b),d=this.FindBlock(a+1,b);if(null!==c&&null!==d){if(c.state===Block.EState.Blocked&&d.state===Block.EState.Blocked)return this.SwapBlocks(c,d),!0}else{if(null!==c&&this.IsBlockIndexFree(a+1,b)&&c.state===Block.EState.Blocked){var e=new Block;return e.type=Block.EType.PlaceHolder,e.state=Block.EState.SwappedLeft,e.verticalPosition=c.verticalPosition,this.InsertBlock(e,a+1),this.SwapBlocks(c,e),!0}if(null!==d&&this.IsBlockIndexFree(a,b)&&d.state===Block.EState.Blocked){var f=new Block;return f.type=Block.EType.PlaceHolder,f.state=Block.EState.SwappedRight,f.verticalPosition=d.verticalPosition,this.InsertBlock(f,a),this.SwapBlocks(f,d),!0}}return!1},Grid.prototype.SwapBlocks=function(a,b){"use strict";var c=a.GetCopy();a.LoadFrom(b),b.LoadFrom(c),a.SetState(Block.EState.SwappedLeft),b.SetState(Block.EState.SwappedRight)},Grid.prototype.Load=function(a){"use strict";var b,c;for(b=0;b<a.grid.length;b+=1)for(c=0;c<a.grid[b].length;c+=1){var d=new Block;d.state=a.grid[b][c].state,d.type=a.grid[b][c].type,d.verticalPosition=this.container[b].length*CONFIG.pixelPerBox,this.container[b].push(d)}},Grid.prototype.Evaluate=function(a){"use strict";var b=new GridEvaluator(a);return b.Evaluate(this.container)},Grid.prototype.BlockCount=function(){"use strict";for(var a=0,b=0;b<this.container.length;b+=1)a+=this.container[b].length-CONFIG.hiddenRowCount;return a},Grid.prototype.AddNewLine=function(){"use strict";var a,b;for(a=0;a<CONFIG.columnCount;a+=1){for(b=0;b<this.container[a].length;b+=1)this.container[a][b].verticalPosition+=CONFIG.pixelPerBox;this.container[a].unshift(new Block)}},Grid.prototype.RemoveBlockFixed=function(a,b){"use strict";var c=this.container[a][b];return this.container[a].splice(b,1),this.MakeTopBlockFall(a,b),c},Grid.prototype.RemoveBlock=function(a,b){"use strict";var c=this.FindBlockIndex(a,b);if(-1===c)throw"Not my day";return this.RemoveBlockFixed(a,c)},Grid.prototype.InsertBlock=function(a,b){"use strict";for(var c=0;c<this.container[b].length;c+=1)if(this.container[b][c].verticalPosition>a.verticalPosition)return void this.container[b].splice(c,0,a);this.container[b].push(a)},Grid.prototype.FindBlock=function(a,b){"use strict";var c=this.FindBlockIndex(a,b);return-1===c?null:this.container[a][c]},Grid.prototype.FindBlockIndex=function(a,b){"use strict";var c;for(c in this.container[a])if(this.container[a].hasOwnProperty(c)&&this.container[a][c].verticalPosition===CONFIG.pixelPerBox*b)return parseInt(c);return-1},Grid.prototype.IsBlockIndexFree=function(a,b){"use strict";var c;for(c in this.container[a])if(this.container[a].hasOwnProperty(c)&&this.container[a][c].verticalPosition>=CONFIG.pixelPerBox*b&&this.container[a][c].verticalPosition<CONFIG.pixelPerBox*(b+1))return!1;return!0},Grid.prototype.MakeTopBlockFall=function(a,b){"use strict";if(0>b)throw"Not my day";for(var c=b;c<this.container[a].length&&this.container[a][c].state===Block.EState.Blocked;c+=1)this.container[a][c].SetState(Block.EState.Falling)},Grid.prototype.AnimateBlockFall=function(a,b,c,d){"use strict";return c.verticalPosition-=CONFIG.fallSpeedPerTic,c.verticalPosition<d&&(c.verticalPosition=d,this.container[a][b-1].state!==Block.EState.Falling&&c.SetState(Block.EState.Blocked)),{min:c.verticalPosition+CONFIG.pixelPerBox,deltaY:0}},Grid.prototype.AnimateBlockDisappear=function(a,b,c,d){"use strict";return c.animationState+=CONFIG.disapearSpeedPerTic,c.animationState>100&&-1===c.id?(this.container[a].splice(b,1),this.MakeTopBlockFall(a,b),{min:d,deltaY:-1}):{min:c.verticalPosition+CONFIG.pixelPerBox,deltaY:0}},Grid.prototype.AnimateSwapped=function(a,b,c,d){"use strict";if(c.animationState+=15,c.animationState>100){if(c.type===Block.EType.PlaceHolder)return this.RemoveBlockFixed(a,b),{min:d,deltaY:-1};this.container[a][b-1].state===Block.EState.Falling||this.container[a][b-1].verticalPosition<c.verticalPosition-CONFIG.pixelPerBox?(c.SetState(Block.EState.Falling),this.MakeTopBlockFall(a,b+1)):c.SetState(Block.EState.Blocked)}return{min:c.verticalPosition+CONFIG.pixelPerBox,deltaY:0}},Grid.prototype.AnimateBlock=function(a,b,c){"use strict";var d=this.container[a][b];switch(d.state){case Block.EState.Blocked:return{min:d.verticalPosition+CONFIG.pixelPerBox,deltaY:0};case Block.EState.Disappearing:return this.AnimateBlockDisappear(a,b,d,c);case Block.EState.Falling:return this.AnimateBlockFall(a,b,d,c);case Block.EState.SwappedRight:case Block.EState.SwappedLeft:return this.AnimateSwapped(a,b,d,c)}throw"Unsupported animation"},Grid.prototype.AnimateColumn=function(a){"use strict";var b,c,d;for(c=CONFIG.hiddenRowCount*CONFIG.pixelPerBox,b=CONFIG.hiddenRowCount;b<this.container[a].length;b+=1)d=this.AnimateBlock(a,b,c),c=d.min,b+=d.deltaY},Grid.prototype.Animate=function(){"use strict";for(var a=0;a<CONFIG.columnCount;a+=1)this.AnimateColumn(a)},Grid.prototype.GetMaxFixed=function(){"use strict";var a,b,c=0;for(a=0;a<CONFIG.columnCount;a+=1)for(b=CONFIG.hiddenRowCount;b<this.container[a].length&&this.container[a][b].state===Block.EState.Blocked;b+=1)this.container[a][b].verticalPosition>c&&(c=this.container[a][b].verticalPosition);return c},Grid.prototype.NewBlockFall=function(a){"use strict";var b=new Block;b.SetState(Block.EState.Falling),b.verticalPosition=(CONFIG.hiddenRowCount+CONFIG.displayedRowCount+1)*CONFIG.pixelPerBox,this.container[a].push(b)},Grid.prototype.Swap=function(a,b){"use strict";var c=this.FindBlock(a,b),d=this.FindBlock(a+1,b);if(null!==c&&null!==d){if(c.state===Block.EState.Blocked&&d.state===Block.EState.Blocked)return this.SwapBlocks(c,d),!0}else{if(null!==c&&this.IsBlockIndexFree(a+1,b)&&c.state===Block.EState.Blocked){var e=new Block;return e.type=Block.EType.PlaceHolder,e.state=Block.EState.SwappedLeft,e.verticalPosition=c.verticalPosition,this.InsertBlock(e,a+1),this.SwapBlocks(c,e),!0}if(null!==d&&this.IsBlockIndexFree(a,b)&&d.state===Block.EState.Blocked){var f=new Block;return f.type=Block.EType.PlaceHolder,f.state=Block.EState.SwappedRight,f.verticalPosition=d.verticalPosition,this.InsertBlock(f,a),this.SwapBlocks(f,d),!0}}return!1},Grid.prototype.SwapBlocks=function(a,b){"use strict";var c=a.GetCopy();a.LoadFrom(b),b.LoadFrom(c),a.SetState(Block.EState.SwappedLeft),b.SetState(Block.EState.SwappedRight)},Grid.prototype.Load=function(a){"use strict";var b,c;for(b=0;b<a.grid.length;b+=1)for(c=0;c<a.grid[b].length;c+=1){var d=new Block;d.state=a.grid[b][c].state,d.type=a.grid[b][c].type,d.verticalPosition=this.container[b].length*CONFIG.pixelPerBox,this.container[b].push(d)}},Grid.prototype.Evaluate=function(a){"use strict";var b=new GridEvaluator(a);return b.Evaluate(this.container)},Grid.prototype.BlockCount=function(){"use strict";for(var a=0,b=0;b<this.container.length;b+=1)a+=this.container[b].length-CONFIG.hiddenRowCount;return a},Grid.prototype.AddNewLine=function(){"use strict";var a,b;for(a=0;a<CONFIG.columnCount;a+=1){for(b=0;b<this.container[a].length;b+=1)this.container[a][b].verticalPosition+=CONFIG.pixelPerBox;this.container[a].unshift(new Block)}},Grid.prototype.RemoveBlockFixed=function(a,b){"use strict";var c=this.container[a][b];return this.container[a].splice(b,1),this.MakeTopBlockFall(a,b),c},Grid.prototype.RemoveBlock=function(a,b){"use strict";var c=this.FindBlockIndex(a,b);if(-1===c)throw"Not my day";return this.RemoveBlockFixed(a,c)},Grid.prototype.InsertBlock=function(a,b){"use strict";for(var c=0;c<this.container[b].length;c+=1)if(this.container[b][c].verticalPosition>a.verticalPosition)return void this.container[b].splice(c,0,a);this.container[b].push(a)},Grid.prototype.FindBlock=function(a,b){"use strict";var c=this.FindBlockIndex(a,b);return-1===c?null:this.container[a][c]},Grid.prototype.FindBlockIndex=function(a,b){"use strict";var c;for(c in this.container[a])if(this.container[a].hasOwnProperty(c)&&this.container[a][c].verticalPosition===CONFIG.pixelPerBox*b)return parseInt(c);return-1},Grid.prototype.IsBlockIndexFree=function(a,b){"use strict";var c;for(c in this.container[a])if(this.container[a].hasOwnProperty(c)&&this.container[a][c].verticalPosition>=CONFIG.pixelPerBox*b&&this.container[a][c].verticalPosition<CONFIG.pixelPerBox*(b+1))return!1;return!0},Grid.prototype.MakeTopBlockFall=function(a,b){"use strict";if(0>b)throw"Not my day";for(var c=b;c<this.container[a].length&&this.container[a][c].state===Block.EState.Blocked;c+=1)this.container[a][c].SetState(Block.EState.Falling)},Grid.prototype.AnimateBlockFall=function(a,b,c,d){"use strict";return c.verticalPosition-=CONFIG.fallSpeedPerTic,c.verticalPosition<d&&(c.verticalPosition=d,this.container[a][b-1].state!==Block.EState.Falling&&c.SetState(Block.EState.Blocked)),{min:c.verticalPosition+CONFIG.pixelPerBox,deltaY:0}},Grid.prototype.AnimateBlockDisappear=function(a,b,c,d){"use strict";return c.animationState+=CONFIG.disapearSpeedPerTic,c.animationState>100&&-1===c.id?(this.container[a].splice(b,1),this.MakeTopBlockFall(a,b),{min:d,deltaY:-1}):{min:c.verticalPosition+CONFIG.pixelPerBox,deltaY:0}},Grid.prototype.AnimateSwapped=function(a,b,c,d){"use strict";if(c.animationState+=15,c.animationState>100){if(c.type===Block.EType.PlaceHolder)return this.RemoveBlockFixed(a,b),{min:d,deltaY:-1};this.container[a][b-1].state===Block.EState.Falling||this.container[a][b-1].verticalPosition<c.verticalPosition-CONFIG.pixelPerBox?(c.SetState(Block.EState.Falling),this.MakeTopBlockFall(a,b+1)):c.SetState(Block.EState.Blocked)}return{min:c.verticalPosition+CONFIG.pixelPerBox,deltaY:0}},Grid.prototype.AnimateBlock=function(a,b,c){"use strict";var d=this.container[a][b];switch(d.state){case Block.EState.Blocked:return{min:d.verticalPosition+CONFIG.pixelPerBox,deltaY:0};case Block.EState.Disappearing:return this.AnimateBlockDisappear(a,b,d,c);case Block.EState.Falling:return this.AnimateBlockFall(a,b,d,c);case Block.EState.SwappedRight:case Block.EState.SwappedLeft:return this.AnimateSwapped(a,b,d,c)}throw"Unsupported animation"},Grid.prototype.AnimateColumn=function(a){"use strict";var b,c,d;for(c=CONFIG.hiddenRowCount*CONFIG.pixelPerBox,b=CONFIG.hiddenRowCount;b<this.container[a].length;b+=1)d=this.AnimateBlock(a,b,c),c=d.min,b+=d.deltaY},Grid.prototype.Animate=function(){"use strict";for(var a=0;a<CONFIG.columnCount;a+=1)this.AnimateColumn(a)},Grid.prototype.GetMaxFixed=function(){"use strict";var a,b,c=0;for(a=0;a<CONFIG.columnCount;a+=1)for(b=CONFIG.hiddenRowCount;b<this.container[a].length&&this.container[a][b].state===Block.EState.Blocked;b+=1)this.container[a][b].verticalPosition>c&&(c=this.container[a][b].verticalPosition);return c},Grid.prototype.NewBlockFall=function(a){"use strict";var b=new Block;b.SetState(Block.EState.Falling),b.verticalPosition=(CONFIG.hiddenRowCount+CONFIG.displayedRowCount+1)*CONFIG.pixelPerBox,this.container[a].push(b)},Grid.prototype.Swap=function(a,b){"use strict";var c=this.FindBlock(a,b),d=this.FindBlock(a+1,b);if(null!==c&&null!==d){if(c.state===Block.EState.Blocked&&d.state===Block.EState.Blocked)return this.SwapBlocks(c,d),!0}else{if(null!==c&&this.IsBlockIndexFree(a+1,b)&&c.state===Block.EState.Blocked){var e=new Block;return e.type=Block.EType.PlaceHolder,e.state=Block.EState.SwappedLeft,e.verticalPosition=c.verticalPosition,this.InsertBlock(e,a+1),this.SwapBlocks(c,e),!0}if(null!==d&&this.IsBlockIndexFree(a,b)&&d.state===Block.EState.Blocked){var f=new Block;return f.type=Block.EType.PlaceHolder,f.state=Block.EState.SwappedRight,f.verticalPosition=d.verticalPosition,this.InsertBlock(f,a),this.SwapBlocks(f,d),!0}}return!1},Grid.prototype.SwapBlocks=function(a,b){"use strict";var c=a.GetCopy();a.LoadFrom(b),b.LoadFrom(c),a.SetState(Block.EState.SwappedLeft),b.SetState(Block.EState.SwappedRight)},Grid.prototype.Load=function(a){"use strict";var b,c;for(b=0;b<a.grid.length;b+=1)for(c=0;c<a.grid[b].length;c+=1){var d=new Block;d.state=a.grid[b][c].state,d.type=a.grid[b][c].type,d.verticalPosition=this.container[b].length*CONFIG.pixelPerBox,this.container[b].push(d)}},Grid.prototype.Evaluate=function(a){"use strict";var b=new GridEvaluator(a);return b.Evaluate(this.container)},Grid.prototype.BlockCount=function(){"use strict";for(var a=0,b=0;b<this.container.length;b+=1)a+=this.container[b].length-CONFIG.hiddenRowCount;return a},Grid.prototype.AddNewLine=function(){"use strict";var a,b;for(a=0;a<CONFIG.columnCount;a+=1){for(b=0;b<this.container[a].length;b+=1)this.container[a][b].verticalPosition+=CONFIG.pixelPerBox;this.container[a].unshift(new Block)}},Grid.prototype.RemoveBlockFixed=function(a,b){"use strict";var c=this.container[a][b];return this.container[a].splice(b,1),this.MakeTopBlockFall(a,b),c},Grid.prototype.RemoveBlock=function(a,b){"use strict";var c=this.FindBlockIndex(a,b);if(-1===c)throw"Not my day";return this.RemoveBlockFixed(a,c)},Grid.prototype.InsertBlock=function(a,b){"use strict";for(var c=0;c<this.container[b].length;c+=1)if(this.container[b][c].verticalPosition>a.verticalPosition)return void this.container[b].splice(c,0,a);this.container[b].push(a)},Grid.prototype.FindBlock=function(a,b){"use strict";var c=this.FindBlockIndex(a,b);return-1===c?null:this.container[a][c]},Grid.prototype.FindBlockIndex=function(a,b){"use strict";var c;for(c in this.container[a])if(this.container[a].hasOwnProperty(c)&&this.container[a][c].verticalPosition===CONFIG.pixelPerBox*b)return parseInt(c);return-1},Grid.prototype.IsBlockIndexFree=function(a,b){"use strict";var c;for(c in this.container[a])if(this.container[a].hasOwnProperty(c)&&this.container[a][c].verticalPosition>=CONFIG.pixelPerBox*b&&this.container[a][c].verticalPosition<CONFIG.pixelPerBox*(b+1))return!1;return!0},Grid.prototype.MakeTopBlockFall=function(a,b){"use strict";if(0>b)throw"Not my day";for(var c=b;c<this.container[a].length&&this.container[a][c].state===Block.EState.Blocked;c+=1)this.container[a][c].SetState(Block.EState.Falling)},Grid.prototype.AnimateBlockFall=function(a,b,c,d){"use strict";return c.verticalPosition-=CONFIG.fallSpeedPerTic,c.verticalPosition<d&&(c.verticalPosition=d,this.container[a][b-1].state!==Block.EState.Falling&&c.SetState(Block.EState.Blocked)),{min:c.verticalPosition+CONFIG.pixelPerBox,deltaY:0}},Grid.prototype.AnimateBlockDisappear=function(a,b,c,d){"use strict";return c.animationState+=CONFIG.disapearSpeedPerTic,c.animationState>100&&-1===c.id?(this.container[a].splice(b,1),this.MakeTopBlockFall(a,b),{min:d,deltaY:-1}):{min:c.verticalPosition+CONFIG.pixelPerBox,deltaY:0}},Grid.prototype.AnimateSwapped=function(a,b,c,d){"use strict";if(c.animationState+=15,c.animationState>100){if(c.type===Block.EType.PlaceHolder)return this.RemoveBlockFixed(a,b),{min:d,deltaY:-1};this.container[a][b-1].state===Block.EState.Falling||this.container[a][b-1].verticalPosition<c.verticalPosition-CONFIG.pixelPerBox?(c.SetState(Block.EState.Falling),this.MakeTopBlockFall(a,b+1)):c.SetState(Block.EState.Blocked)}return{min:c.verticalPosition+CONFIG.pixelPerBox,deltaY:0}},Grid.prototype.AnimateBlock=function(a,b,c){"use strict";var d=this.container[a][b];switch(d.state){case Block.EState.Blocked:return{min:d.verticalPosition+CONFIG.pixelPerBox,deltaY:0};case Block.EState.Disappearing:return this.AnimateBlockDisappear(a,b,d,c);case Block.EState.Falling:return this.AnimateBlockFall(a,b,d,c);case Block.EState.SwappedRight:case Block.EState.SwappedLeft:return this.AnimateSwapped(a,b,d,c)}throw"Unsupported animation"},Grid.prototype.AnimateColumn=function(a){"use strict";var b,c,d;for(c=CONFIG.hiddenRowCount*CONFIG.pixelPerBox,b=CONFIG.hiddenRowCount;b<this.container[a].length;b+=1)d=this.AnimateBlock(a,b,c),c=d.min,b+=d.deltaY},Grid.prototype.Animate=function(){"use strict";for(var a=0;a<CONFIG.columnCount;a+=1)this.AnimateColumn(a)},Grid.prototype.GetMaxFixed=function(){"use strict";var a,b,c=0;for(a=0;a<CONFIG.columnCount;a+=1)for(b=CONFIG.hiddenRowCount;b<this.container[a].length&&this.container[a][b].state===Block.EState.Blocked;b+=1)this.container[a][b].verticalPosition>c&&(c=this.container[a][b].verticalPosition);return c},Grid.prototype.NewBlockFall=function(a){"use strict";var b=new Block;b.SetState(Block.EState.Falling),b.verticalPosition=(CONFIG.hiddenRowCount+CONFIG.displayedRowCount+1)*CONFIG.pixelPerBox,this.container[a].push(b)},Grid.prototype.Swap=function(a,b){"use strict";var c=this.FindBlock(a,b),d=this.FindBlock(a+1,b);if(null!==c&&null!==d){if(c.state===Block.EState.Blocked&&d.state===Block.EState.Blocked)return this.SwapBlocks(c,d),!0}else{if(null!==c&&this.IsBlockIndexFree(a+1,b)&&c.state===Block.EState.Blocked){var e=new Block;return e.type=Block.EType.PlaceHolder,e.state=Block.EState.SwappedLeft,e.verticalPosition=c.verticalPosition,this.InsertBlock(e,a+1),this.SwapBlocks(c,e),!0}if(null!==d&&this.IsBlockIndexFree(a,b)&&d.state===Block.EState.Blocked){var f=new Block;return f.type=Block.EType.PlaceHolder,f.state=Block.EState.SwappedRight,f.verticalPosition=d.verticalPosition,this.InsertBlock(f,a),this.SwapBlocks(f,d),!0}}return!1},Grid.prototype.SwapBlocks=function(a,b){"use strict";var c=a.GetCopy();a.LoadFrom(b),b.LoadFrom(c),a.SetState(Block.EState.SwappedLeft),b.SetState(Block.EState.SwappedRight)},Grid.prototype.Load=function(a){"use strict";var b,c;for(b=0;b<a.grid.length;b+=1)for(c=0;c<a.grid[b].length;c+=1){var d=new Block;d.state=a.grid[b][c].state,d.type=a.grid[b][c].type,d.verticalPosition=this.container[b].length*CONFIG.pixelPerBox,this.container[b].push(d)}},Grid.prototype.Evaluate=function(a){"use strict";var b=new GridEvaluator(a);return b.Evaluate(this.container)},Grid.prototype.BlockCount=function(){"use strict";for(var a=0,b=0;b<this.container.length;b+=1)a+=this.container[b].length-CONFIG.hiddenRowCount;return a},Grid.prototype.AddNewLine=function(){"use strict";var a,b;for(a=0;a<CONFIG.columnCount;a+=1){for(b=0;b<this.container[a].length;b+=1)this.container[a][b].verticalPosition+=CONFIG.pixelPerBox;this.container[a].unshift(new Block)}},Grid.prototype.RemoveBlockFixed=function(a,b){"use strict";var c=this.container[a][b];return this.container[a].splice(b,1),this.MakeTopBlockFall(a,b),c},Grid.prototype.RemoveBlock=function(a,b){"use strict";var c=this.FindBlockIndex(a,b);if(-1===c)throw"Not my day";return this.RemoveBlockFixed(a,c)},Grid.prototype.InsertBlock=function(a,b){"use strict";for(var c=0;c<this.container[b].length;c+=1)if(this.container[b][c].verticalPosition>a.verticalPosition)return void this.container[b].splice(c,0,a);this.container[b].push(a)},Grid.prototype.FindBlock=function(a,b){"use strict";var c=this.FindBlockIndex(a,b);return-1===c?null:this.container[a][c]},Grid.prototype.FindBlockIndex=function(a,b){"use strict";var c;for(c in this.container[a])if(this.container[a].hasOwnProperty(c)&&this.container[a][c].verticalPosition===CONFIG.pixelPerBox*b)return parseInt(c);return-1},Grid.prototype.IsBlockIndexFree=function(a,b){"use strict";var c;for(c in this.container[a])if(this.container[a].hasOwnProperty(c)&&this.container[a][c].verticalPosition>=CONFIG.pixelPerBox*b&&this.container[a][c].verticalPosition<CONFIG.pixelPerBox*(b+1))return!1;return!0},Grid.prototype.MakeTopBlockFall=function(a,b){"use strict";if(0>b)throw"Not my day";for(var c=b;c<this.container[a].length&&this.container[a][c].state===Block.EState.Blocked;c+=1)this.container[a][c].SetState(Block.EState.Falling)},Grid.prototype.AnimateBlockFall=function(a,b,c,d){"use strict";return c.verticalPosition-=CONFIG.fallSpeedPerTic,c.verticalPosition<d&&(c.verticalPosition=d,this.container[a][b-1].state!==Block.EState.Falling&&c.SetState(Block.EState.Blocked)),{min:c.verticalPosition+CONFIG.pixelPerBox,deltaY:0}},Grid.prototype.AnimateBlockDisappear=function(a,b,c,d){"use strict";return c.animationState+=CONFIG.disapearSpeedPerTic,c.animationState>100&&-1===c.id?(this.container[a].splice(b,1),this.MakeTopBlockFall(a,b),{min:d,deltaY:-1}):{min:c.verticalPosition+CONFIG.pixelPerBox,deltaY:0}},Grid.prototype.AnimateSwapped=function(a,b,c,d){"use strict";if(c.animationState+=15,c.animationState>100){if(c.type===Block.EType.PlaceHolder)return this.RemoveBlockFixed(a,b),{min:d,deltaY:-1};this.container[a][b-1].state===Block.EState.Falling||this.container[a][b-1].verticalPosition<c.verticalPosition-CONFIG.pixelPerBox?(c.SetState(Block.EState.Falling),this.MakeTopBlockFall(a,b+1)):c.SetState(Block.EState.Blocked)}return{min:c.verticalPosition+CONFIG.pixelPerBox,deltaY:0}},Grid.prototype.AnimateBlock=function(a,b,c){"use strict";var d=this.container[a][b];switch(d.state){case Block.EState.Blocked:return{min:d.verticalPosition+CONFIG.pixelPerBox,deltaY:0};case Block.EState.Disappearing:return this.AnimateBlockDisappear(a,b,d,c);case Block.EState.Falling:return this.AnimateBlockFall(a,b,d,c);case Block.EState.SwappedRight:case Block.EState.SwappedLeft:return this.AnimateSwapped(a,b,d,c)}throw"Unsupported animation"},Grid.prototype.AnimateColumn=function(a){"use strict";var b,c,d;for(c=CONFIG.hiddenRowCount*CONFIG.pixelPerBox,b=CONFIG.hiddenRowCount;b<this.container[a].length;b+=1)d=this.AnimateBlock(a,b,c),c=d.min,b+=d.deltaY},Grid.prototype.Animate=function(){"use strict";for(var a=0;a<CONFIG.columnCount;a+=1)this.AnimateColumn(a)},Grid.prototype.GetMaxFixed=function(){"use strict";var a,b,c=0;for(a=0;a<CONFIG.columnCount;a+=1)for(b=CONFIG.hiddenRowCount;b<this.container[a].length&&this.container[a][b].state===Block.EState.Blocked;b+=1)this.container[a][b].verticalPosition>c&&(c=this.container[a][b].verticalPosition);return c},Grid.prototype.NewBlockFall=function(a){"use strict";var b=new Block;b.SetState(Block.EState.Falling),b.verticalPosition=(CONFIG.hiddenRowCount+CONFIG.displayedRowCount+1)*CONFIG.pixelPerBox,this.container[a].push(b)},Grid.prototype.Swap=function(a,b){"use strict";var c=this.FindBlock(a,b),d=this.FindBlock(a+1,b);if(null!==c&&null!==d){if(c.state===Block.EState.Blocked&&d.state===Block.EState.Blocked)return this.SwapBlocks(c,d),!0}else{if(null!==c&&this.IsBlockIndexFree(a+1,b)&&c.state===Block.EState.Blocked){
var e=new Block;return e.type=Block.EType.PlaceHolder,e.state=Block.EState.SwappedLeft,e.verticalPosition=c.verticalPosition,this.InsertBlock(e,a+1),this.SwapBlocks(c,e),!0}if(null!==d&&this.IsBlockIndexFree(a,b)&&d.state===Block.EState.Blocked){var f=new Block;return f.type=Block.EType.PlaceHolder,f.state=Block.EState.SwappedRight,f.verticalPosition=d.verticalPosition,this.InsertBlock(f,a),this.SwapBlocks(f,d),!0}}return!1},Grid.prototype.SwapBlocks=function(a,b){"use strict";var c=a.GetCopy();a.LoadFrom(b),b.LoadFrom(c),a.SetState(Block.EState.SwappedLeft),b.SetState(Block.EState.SwappedRight)},Grid.prototype.Load=function(a){"use strict";var b,c;for(b=0;b<a.grid.length;b+=1)for(c=0;c<a.grid[b].length;c+=1){var d=new Block;d.state=a.grid[b][c].state,d.type=a.grid[b][c].type,d.verticalPosition=this.container[b].length*CONFIG.pixelPerBox,this.container[b].push(d)}},Grid.prototype.Evaluate=function(a){"use strict";var b=new GridEvaluator(a);return b.Evaluate(this.container)},Grid.prototype.BlockCount=function(){"use strict";for(var a=0,b=0;b<this.container.length;b+=1)a+=this.container[b].length-CONFIG.hiddenRowCount;return a},Grid.prototype.AddNewLine=function(){"use strict";var a,b;for(a=0;a<CONFIG.columnCount;a+=1){for(b=0;b<this.container[a].length;b+=1)this.container[a][b].verticalPosition+=CONFIG.pixelPerBox;this.container[a].unshift(new Block)}},Grid.prototype.RemoveBlockFixed=function(a,b){"use strict";var c=this.container[a][b];return this.container[a].splice(b,1),this.MakeTopBlockFall(a,b),c},Grid.prototype.RemoveBlock=function(a,b){"use strict";var c=this.FindBlockIndex(a,b);if(-1===c)throw"Not my day";return this.RemoveBlockFixed(a,c)},Grid.prototype.InsertBlock=function(a,b){"use strict";for(var c=0;c<this.container[b].length;c+=1)if(this.container[b][c].verticalPosition>a.verticalPosition)return void this.container[b].splice(c,0,a);this.container[b].push(a)},Grid.prototype.FindBlock=function(a,b){"use strict";var c=this.FindBlockIndex(a,b);return-1===c?null:this.container[a][c]},Grid.prototype.FindBlockIndex=function(a,b){"use strict";var c;for(c in this.container[a])if(this.container[a].hasOwnProperty(c)&&this.container[a][c].verticalPosition===CONFIG.pixelPerBox*b)return parseInt(c);return-1},Grid.prototype.IsBlockIndexFree=function(a,b){"use strict";var c;for(c in this.container[a])if(this.container[a].hasOwnProperty(c)&&this.container[a][c].verticalPosition>=CONFIG.pixelPerBox*b&&this.container[a][c].verticalPosition<CONFIG.pixelPerBox*(b+1))return!1;return!0},Grid.prototype.MakeTopBlockFall=function(a,b){"use strict";if(0>b)throw"Not my day";for(var c=b;c<this.container[a].length&&this.container[a][c].state===Block.EState.Blocked;c+=1)this.container[a][c].SetState(Block.EState.Falling)},Grid.prototype.AnimateBlockFall=function(a,b,c,d){"use strict";return c.verticalPosition-=CONFIG.fallSpeedPerTic,c.verticalPosition<d&&(c.verticalPosition=d,this.container[a][b-1].state!==Block.EState.Falling&&c.SetState(Block.EState.Blocked)),{min:c.verticalPosition+CONFIG.pixelPerBox,deltaY:0}},Grid.prototype.AnimateBlockDisappear=function(a,b,c,d){"use strict";return c.animationState+=CONFIG.disapearSpeedPerTic,c.animationState>100&&-1===c.id?(this.container[a].splice(b,1),this.MakeTopBlockFall(a,b),{min:d,deltaY:-1}):{min:c.verticalPosition+CONFIG.pixelPerBox,deltaY:0}},Grid.prototype.AnimateSwapped=function(a,b,c,d){"use strict";if(c.animationState+=15,c.animationState>100){if(c.type===Block.EType.PlaceHolder)return this.RemoveBlockFixed(a,b),{min:d,deltaY:-1};this.container[a][b-1].state===Block.EState.Falling||this.container[a][b-1].verticalPosition<c.verticalPosition-CONFIG.pixelPerBox?(c.SetState(Block.EState.Falling),this.MakeTopBlockFall(a,b+1)):c.SetState(Block.EState.Blocked)}return{min:c.verticalPosition+CONFIG.pixelPerBox,deltaY:0}},Grid.prototype.AnimateBlock=function(a,b,c){"use strict";var d=this.container[a][b];switch(d.state){case Block.EState.Blocked:return{min:d.verticalPosition+CONFIG.pixelPerBox,deltaY:0};case Block.EState.Disappearing:return this.AnimateBlockDisappear(a,b,d,c);case Block.EState.Falling:return this.AnimateBlockFall(a,b,d,c);case Block.EState.SwappedRight:case Block.EState.SwappedLeft:return this.AnimateSwapped(a,b,d,c)}throw"Unsupported animation"},Grid.prototype.AnimateColumn=function(a){"use strict";var b,c,d;for(c=CONFIG.hiddenRowCount*CONFIG.pixelPerBox,b=CONFIG.hiddenRowCount;b<this.container[a].length;b+=1)d=this.AnimateBlock(a,b,c),c=d.min,b+=d.deltaY},Grid.prototype.Animate=function(){"use strict";for(var a=0;a<CONFIG.columnCount;a+=1)this.AnimateColumn(a)},Grid.prototype.GetMaxFixed=function(){"use strict";var a,b,c=0;for(a=0;a<CONFIG.columnCount;a+=1)for(b=CONFIG.hiddenRowCount;b<this.container[a].length&&this.container[a][b].state===Block.EState.Blocked;b+=1)this.container[a][b].verticalPosition>c&&(c=this.container[a][b].verticalPosition);return c},Grid.prototype.NewBlockFall=function(a){"use strict";var b=new Block;b.SetState(Block.EState.Falling),b.verticalPosition=(CONFIG.hiddenRowCount+CONFIG.displayedRowCount+1)*CONFIG.pixelPerBox,this.container[a].push(b)},Grid.prototype.Swap=function(a,b){"use strict";var c=this.FindBlock(a,b),d=this.FindBlock(a+1,b);if(null!==c&&null!==d){if(c.state===Block.EState.Blocked&&d.state===Block.EState.Blocked)return this.SwapBlocks(c,d),!0}else{if(null!==c&&this.IsBlockIndexFree(a+1,b)&&c.state===Block.EState.Blocked){var e=new Block;return e.type=Block.EType.PlaceHolder,e.state=Block.EState.SwappedLeft,e.verticalPosition=c.verticalPosition,this.InsertBlock(e,a+1),this.SwapBlocks(c,e),!0}if(null!==d&&this.IsBlockIndexFree(a,b)&&d.state===Block.EState.Blocked){var f=new Block;return f.type=Block.EType.PlaceHolder,f.state=Block.EState.SwappedRight,f.verticalPosition=d.verticalPosition,this.InsertBlock(f,a),this.SwapBlocks(f,d),!0}}return!1},Grid.prototype.SwapBlocks=function(a,b){"use strict";var c=a.GetCopy();a.LoadFrom(b),b.LoadFrom(c),a.SetState(Block.EState.SwappedLeft),b.SetState(Block.EState.SwappedRight)},Grid.prototype.Load=function(a){"use strict";var b,c;for(b=0;b<a.grid.length;b+=1)for(c=0;c<a.grid[b].length;c+=1){var d=new Block;d.state=a.grid[b][c].state,d.type=a.grid[b][c].type,d.verticalPosition=this.container[b].length*CONFIG.pixelPerBox,this.container[b].push(d)}},Grid.prototype.Evaluate=function(a){"use strict";var b=new GridEvaluator(a);return b.Evaluate(this.container)},Grid.prototype.BlockCount=function(){"use strict";for(var a=0,b=0;b<this.container.length;b+=1)a+=this.container[b].length-CONFIG.hiddenRowCount;return a},Grid.prototype.AddNewLine=function(){"use strict";var a,b;for(a=0;a<CONFIG.columnCount;a+=1){for(b=0;b<this.container[a].length;b+=1)this.container[a][b].verticalPosition+=CONFIG.pixelPerBox;this.container[a].unshift(new Block)}},Grid.prototype.RemoveBlockFixed=function(a,b){"use strict";var c=this.container[a][b];return this.container[a].splice(b,1),this.MakeTopBlockFall(a,b),c},Grid.prototype.RemoveBlock=function(a,b){"use strict";var c=this.FindBlockIndex(a,b);if(-1===c)throw"Not my day";return this.RemoveBlockFixed(a,c)},Grid.prototype.InsertBlock=function(a,b){"use strict";for(var c=0;c<this.container[b].length;c+=1)if(this.container[b][c].verticalPosition>a.verticalPosition)return void this.container[b].splice(c,0,a);this.container[b].push(a)},Grid.prototype.FindBlock=function(a,b){"use strict";var c=this.FindBlockIndex(a,b);return-1===c?null:this.container[a][c]},Grid.prototype.FindBlockIndex=function(a,b){"use strict";var c;for(c in this.container[a])if(this.container[a].hasOwnProperty(c)&&this.container[a][c].verticalPosition===CONFIG.pixelPerBox*b)return parseInt(c);return-1},Grid.prototype.IsBlockIndexFree=function(a,b){"use strict";var c;for(c in this.container[a])if(this.container[a].hasOwnProperty(c)&&this.container[a][c].verticalPosition>=CONFIG.pixelPerBox*b&&this.container[a][c].verticalPosition<CONFIG.pixelPerBox*(b+1))return!1;return!0},Grid.prototype.MakeTopBlockFall=function(a,b){"use strict";if(0>b)throw"Not my day";for(var c=b;c<this.container[a].length&&this.container[a][c].state===Block.EState.Blocked;c+=1)this.container[a][c].SetState(Block.EState.Falling)},Grid.prototype.AnimateBlockFall=function(a,b,c,d){"use strict";return c.verticalPosition-=CONFIG.fallSpeedPerTic,c.verticalPosition<d&&(c.verticalPosition=d,this.container[a][b-1].state!==Block.EState.Falling&&c.SetState(Block.EState.Blocked)),{min:c.verticalPosition+CONFIG.pixelPerBox,deltaY:0}},Grid.prototype.AnimateBlockDisappear=function(a,b,c,d){"use strict";return c.animationState+=CONFIG.disapearSpeedPerTic,c.animationState>100&&-1===c.id?(this.container[a].splice(b,1),this.MakeTopBlockFall(a,b),{min:d,deltaY:-1}):{min:c.verticalPosition+CONFIG.pixelPerBox,deltaY:0}},Grid.prototype.AnimateSwapped=function(a,b,c,d){"use strict";if(c.animationState+=15,c.animationState>100){if(c.type===Block.EType.PlaceHolder)return this.RemoveBlockFixed(a,b),{min:d,deltaY:-1};this.container[a][b-1].state===Block.EState.Falling||this.container[a][b-1].verticalPosition<c.verticalPosition-CONFIG.pixelPerBox?(c.SetState(Block.EState.Falling),this.MakeTopBlockFall(a,b+1)):c.SetState(Block.EState.Blocked)}return{min:c.verticalPosition+CONFIG.pixelPerBox,deltaY:0}},Grid.prototype.AnimateBlock=function(a,b,c){"use strict";var d=this.container[a][b];switch(d.state){case Block.EState.Blocked:return{min:d.verticalPosition+CONFIG.pixelPerBox,deltaY:0};case Block.EState.Disappearing:return this.AnimateBlockDisappear(a,b,d,c);case Block.EState.Falling:return this.AnimateBlockFall(a,b,d,c);case Block.EState.SwappedRight:case Block.EState.SwappedLeft:return this.AnimateSwapped(a,b,d,c)}throw"Unsupported animation"},Grid.prototype.AnimateColumn=function(a){"use strict";var b,c,d;for(c=CONFIG.hiddenRowCount*CONFIG.pixelPerBox,b=CONFIG.hiddenRowCount;b<this.container[a].length;b+=1)d=this.AnimateBlock(a,b,c),c=d.min,b+=d.deltaY},Grid.prototype.Animate=function(){"use strict";for(var a=0;a<CONFIG.columnCount;a+=1)this.AnimateColumn(a)},Grid.prototype.GetMaxFixed=function(){"use strict";var a,b,c=0;for(a=0;a<CONFIG.columnCount;a+=1)for(b=CONFIG.hiddenRowCount;b<this.container[a].length&&this.container[a][b].state===Block.EState.Blocked;b+=1)this.container[a][b].verticalPosition>c&&(c=this.container[a][b].verticalPosition);return c},Grid.prototype.NewBlockFall=function(a){"use strict";var b=new Block;b.SetState(Block.EState.Falling),b.verticalPosition=(CONFIG.hiddenRowCount+CONFIG.displayedRowCount+1)*CONFIG.pixelPerBox,this.container[a].push(b)},Grid.prototype.Swap=function(a,b){"use strict";var c=this.FindBlock(a,b),d=this.FindBlock(a+1,b);if(null!==c&&null!==d){if(c.state===Block.EState.Blocked&&d.state===Block.EState.Blocked)return this.SwapBlocks(c,d),!0}else{if(null!==c&&this.IsBlockIndexFree(a+1,b)&&c.state===Block.EState.Blocked){var e=new Block;return e.type=Block.EType.PlaceHolder,e.state=Block.EState.SwappedLeft,e.verticalPosition=c.verticalPosition,this.InsertBlock(e,a+1),this.SwapBlocks(c,e),!0}if(null!==d&&this.IsBlockIndexFree(a,b)&&d.state===Block.EState.Blocked){var f=new Block;return f.type=Block.EType.PlaceHolder,f.state=Block.EState.SwappedRight,f.verticalPosition=d.verticalPosition,this.InsertBlock(f,a),this.SwapBlocks(f,d),!0}}return!1},Grid.prototype.SwapBlocks=function(a,b){"use strict";var c=a.GetCopy();a.LoadFrom(b),b.LoadFrom(c),a.SetState(Block.EState.SwappedLeft),b.SetState(Block.EState.SwappedRight)},Grid.prototype.Load=function(a){"use strict";var b,c;for(b=0;b<a.grid.length;b+=1)for(c=0;c<a.grid[b].length;c+=1){var d=new Block;d.state=a.grid[b][c].state,d.type=a.grid[b][c].type,d.verticalPosition=this.container[b].length*CONFIG.pixelPerBox,this.container[b].push(d)}},Grid.prototype.Evaluate=function(a){"use strict";var b=new GridEvaluator(a);return b.Evaluate(this.container)},Grid.prototype.BlockCount=function(){"use strict";for(var a=0,b=0;b<this.container.length;b+=1)a+=this.container[b].length-CONFIG.hiddenRowCount;return a},Grid.prototype.AddNewLine=function(){"use strict";var a,b;for(a=0;a<CONFIG.columnCount;a+=1){for(b=0;b<this.container[a].length;b+=1)this.container[a][b].verticalPosition+=CONFIG.pixelPerBox;this.container[a].unshift(new Block)}},Grid.prototype.RemoveBlockFixed=function(a,b){"use strict";var c=this.container[a][b];return this.container[a].splice(b,1),this.MakeTopBlockFall(a,b),c},Grid.prototype.RemoveBlock=function(a,b){"use strict";var c=this.FindBlockIndex(a,b);if(-1===c)throw"Not my day";return this.RemoveBlockFixed(a,c)},Grid.prototype.InsertBlock=function(a,b){"use strict";for(var c=0;c<this.container[b].length;c+=1)if(this.container[b][c].verticalPosition>a.verticalPosition)return void this.container[b].splice(c,0,a);this.container[b].push(a)},Grid.prototype.FindBlock=function(a,b){"use strict";var c=this.FindBlockIndex(a,b);return-1===c?null:this.container[a][c]},Grid.prototype.FindBlockIndex=function(a,b){"use strict";var c;for(c in this.container[a])if(this.container[a].hasOwnProperty(c)&&this.container[a][c].verticalPosition===CONFIG.pixelPerBox*b)return parseInt(c);return-1},Grid.prototype.IsBlockIndexFree=function(a,b){"use strict";var c;for(c in this.container[a])if(this.container[a].hasOwnProperty(c)&&this.container[a][c].verticalPosition>=CONFIG.pixelPerBox*b&&this.container[a][c].verticalPosition<CONFIG.pixelPerBox*(b+1))return!1;return!0},Grid.prototype.MakeTopBlockFall=function(a,b){"use strict";if(0>b)throw"Not my day";for(var c=b;c<this.container[a].length&&this.container[a][c].state===Block.EState.Blocked;c+=1)this.container[a][c].SetState(Block.EState.Falling)},Grid.prototype.AnimateBlockFall=function(a,b,c,d){"use strict";return c.verticalPosition-=CONFIG.fallSpeedPerTic,c.verticalPosition<d&&(c.verticalPosition=d,this.container[a][b-1].state!==Block.EState.Falling&&c.SetState(Block.EState.Blocked)),{min:c.verticalPosition+CONFIG.pixelPerBox,deltaY:0}},Grid.prototype.AnimateBlockDisappear=function(a,b,c,d){"use strict";return c.animationState+=CONFIG.disapearSpeedPerTic,c.animationState>100&&-1===c.id?(this.container[a].splice(b,1),this.MakeTopBlockFall(a,b),{min:d,deltaY:-1}):{min:c.verticalPosition+CONFIG.pixelPerBox,deltaY:0}},Grid.prototype.AnimateSwapped=function(a,b,c,d){"use strict";if(c.animationState+=15,c.animationState>100){if(c.type===Block.EType.PlaceHolder)return this.RemoveBlockFixed(a,b),{min:d,deltaY:-1};this.container[a][b-1].state===Block.EState.Falling||this.container[a][b-1].verticalPosition<c.verticalPosition-CONFIG.pixelPerBox?(c.SetState(Block.EState.Falling),this.MakeTopBlockFall(a,b+1)):c.SetState(Block.EState.Blocked)}return{min:c.verticalPosition+CONFIG.pixelPerBox,deltaY:0}},Grid.prototype.AnimateBlock=function(a,b,c){"use strict";var d=this.container[a][b];switch(d.state){case Block.EState.Blocked:return{min:d.verticalPosition+CONFIG.pixelPerBox,deltaY:0};case Block.EState.Disappearing:return this.AnimateBlockDisappear(a,b,d,c);case Block.EState.Falling:return this.AnimateBlockFall(a,b,d,c);case Block.EState.SwappedRight:case Block.EState.SwappedLeft:return this.AnimateSwapped(a,b,d,c)}throw"Unsupported animation"},Grid.prototype.AnimateColumn=function(a){"use strict";var b,c,d;for(c=CONFIG.hiddenRowCount*CONFIG.pixelPerBox,b=CONFIG.hiddenRowCount;b<this.container[a].length;b+=1)d=this.AnimateBlock(a,b,c),c=d.min,b+=d.deltaY},Grid.prototype.Animate=function(){"use strict";for(var a=0;a<CONFIG.columnCount;a+=1)this.AnimateColumn(a)},Grid.prototype.GetMaxFixed=function(){"use strict";var a,b,c=0;for(a=0;a<CONFIG.columnCount;a+=1)for(b=CONFIG.hiddenRowCount;b<this.container[a].length&&this.container[a][b].state===Block.EState.Blocked;b+=1)this.container[a][b].verticalPosition>c&&(c=this.container[a][b].verticalPosition);return c},Grid.prototype.NewBlockFall=function(a){"use strict";var b=new Block;b.SetState(Block.EState.Falling),b.verticalPosition=(CONFIG.hiddenRowCount+CONFIG.displayedRowCount+1)*CONFIG.pixelPerBox,this.container[a].push(b)},Grid.prototype.Swap=function(a,b){"use strict";var c=this.FindBlock(a,b),d=this.FindBlock(a+1,b);if(null!==c&&null!==d){if(c.state===Block.EState.Blocked&&d.state===Block.EState.Blocked)return this.SwapBlocks(c,d),!0}else{if(null!==c&&this.IsBlockIndexFree(a+1,b)&&c.state===Block.EState.Blocked){var e=new Block;return e.type=Block.EType.PlaceHolder,e.state=Block.EState.SwappedLeft,e.verticalPosition=c.verticalPosition,this.InsertBlock(e,a+1),this.SwapBlocks(c,e),!0}if(null!==d&&this.IsBlockIndexFree(a,b)&&d.state===Block.EState.Blocked){var f=new Block;return f.type=Block.EType.PlaceHolder,f.state=Block.EState.SwappedRight,f.verticalPosition=d.verticalPosition,this.InsertBlock(f,a),this.SwapBlocks(f,d),!0}}return!1},Grid.prototype.SwapBlocks=function(a,b){"use strict";var c=a.GetCopy();a.LoadFrom(b),b.LoadFrom(c),a.SetState(Block.EState.SwappedLeft),b.SetState(Block.EState.SwappedRight)},Grid.prototype.Load=function(a){"use strict";var b,c;for(b=0;b<a.grid.length;b+=1)for(c=0;c<a.grid[b].length;c+=1){var d=new Block;d.state=a.grid[b][c].state,d.type=a.grid[b][c].type,d.verticalPosition=this.container[b].length*CONFIG.pixelPerBox,this.container[b].push(d)}},Grid.prototype.Evaluate=function(a){"use strict";var b=new GridEvaluator(a);return b.Evaluate(this.container)},Grid.prototype.BlockCount=function(){"use strict";for(var a=0,b=0;b<this.container.length;b+=1)a+=this.container[b].length-CONFIG.hiddenRowCount;return a},Grid.prototype.AddNewLine=function(){"use strict";var a,b;for(a=0;a<CONFIG.columnCount;a+=1){for(b=0;b<this.container[a].length;b+=1)this.container[a][b].verticalPosition+=CONFIG.pixelPerBox;this.container[a].unshift(new Block)}},Grid.prototype.RemoveBlockFixed=function(a,b){"use strict";var c=this.container[a][b];return this.container[a].splice(b,1),this.MakeTopBlockFall(a,b),c},Grid.prototype.RemoveBlock=function(a,b){"use strict";var c=this.FindBlockIndex(a,b);if(-1===c)throw"Not my day";return this.RemoveBlockFixed(a,c)},Grid.prototype.InsertBlock=function(a,b){"use strict";for(var c=0;c<this.container[b].length;c+=1)if(this.container[b][c].verticalPosition>a.verticalPosition)return void this.container[b].splice(c,0,a);this.container[b].push(a)},Grid.prototype.FindBlock=function(a,b){"use strict";var c=this.FindBlockIndex(a,b);return-1===c?null:this.container[a][c]},Grid.prototype.FindBlockIndex=function(a,b){"use strict";var c;for(c in this.container[a])if(this.container[a].hasOwnProperty(c)&&this.container[a][c].verticalPosition===CONFIG.pixelPerBox*b)return parseInt(c);return-1},Grid.prototype.IsBlockIndexFree=function(a,b){"use strict";var c;for(c in this.container[a])if(this.container[a].hasOwnProperty(c)&&this.container[a][c].verticalPosition>=CONFIG.pixelPerBox*b&&this.container[a][c].verticalPosition<CONFIG.pixelPerBox*(b+1))return!1;return!0},Grid.prototype.MakeTopBlockFall=function(a,b){"use strict";if(0>b)throw"Not my day";for(var c=b;c<this.container[a].length&&this.container[a][c].state===Block.EState.Blocked;c+=1)this.container[a][c].SetState(Block.EState.Falling)},Grid.prototype.AnimateBlockFall=function(a,b,c,d){"use strict";return c.verticalPosition-=CONFIG.fallSpeedPerTic,c.verticalPosition<d&&(c.verticalPosition=d,this.container[a][b-1].state!==Block.EState.Falling&&c.SetState(Block.EState.Blocked)),{min:c.verticalPosition+CONFIG.pixelPerBox,deltaY:0}},Grid.prototype.AnimateBlockDisappear=function(a,b,c,d){"use strict";return c.animationState+=CONFIG.disapearSpeedPerTic,c.animationState>100&&-1===c.id?(this.container[a].splice(b,1),this.MakeTopBlockFall(a,b),{min:d,deltaY:-1}):{min:c.verticalPosition+CONFIG.pixelPerBox,deltaY:0}},Grid.prototype.AnimateSwapped=function(a,b,c,d){"use strict";if(c.animationState+=15,c.animationState>100){if(c.type===Block.EType.PlaceHolder)return this.RemoveBlockFixed(a,b),{min:d,deltaY:-1};this.container[a][b-1].state===Block.EState.Falling||this.container[a][b-1].verticalPosition<c.verticalPosition-CONFIG.pixelPerBox?(c.SetState(Block.EState.Falling),this.MakeTopBlockFall(a,b+1)):c.SetState(Block.EState.Blocked)}return{min:c.verticalPosition+CONFIG.pixelPerBox,deltaY:0}},Grid.prototype.AnimateBlock=function(a,b,c){"use strict";var d=this.container[a][b];switch(d.state){case Block.EState.Blocked:return{min:d.verticalPosition+CONFIG.pixelPerBox,deltaY:0};case Block.EState.Disappearing:return this.AnimateBlockDisappear(a,b,d,c);case Block.EState.Falling:return this.AnimateBlockFall(a,b,d,c);case Block.EState.SwappedRight:case Block.EState.SwappedLeft:return this.AnimateSwapped(a,b,d,c)}throw"Unsupported animation"},Grid.prototype.AnimateColumn=function(a){"use strict";var b,c,d;for(c=CONFIG.hiddenRowCount*CONFIG.pixelPerBox,b=CONFIG.hiddenRowCount;b<this.container[a].length;b+=1)d=this.AnimateBlock(a,b,c),c=d.min,b+=d.deltaY},Grid.prototype.Animate=function(){"use strict";for(var a=0;a<CONFIG.columnCount;a+=1)this.AnimateColumn(a)},Grid.prototype.GetMaxFixed=function(){"use strict";var a,b,c=0;for(a=0;a<CONFIG.columnCount;a+=1)for(b=CONFIG.hiddenRowCount;b<this.container[a].length&&this.container[a][b].state===Block.EState.Blocked;b+=1)this.container[a][b].verticalPosition>c&&(c=this.container[a][b].verticalPosition);return c},Grid.prototype.NewBlockFall=function(a){"use strict";var b=new Block;b.SetState(Block.EState.Falling),b.verticalPosition=(CONFIG.hiddenRowCount+CONFIG.displayedRowCount+1)*CONFIG.pixelPerBox,this.container[a].push(b)},Grid.prototype.Swap=function(a,b){"use strict";var c=this.FindBlock(a,b),d=this.FindBlock(a+1,b);if(null!==c&&null!==d){if(c.state===Block.EState.Blocked&&d.state===Block.EState.Blocked)return this.SwapBlocks(c,d),!0}else{if(null!==c&&this.IsBlockIndexFree(a+1,b)&&c.state===Block.EState.Blocked){var e=new Block;return e.type=Block.EType.PlaceHolder,e.state=Block.EState.SwappedLeft,e.verticalPosition=c.verticalPosition,this.InsertBlock(e,a+1),this.SwapBlocks(c,e),!0}if(null!==d&&this.IsBlockIndexFree(a,b)&&d.state===Block.EState.Blocked){var f=new Block;return f.type=Block.EType.PlaceHolder,f.state=Block.EState.SwappedRight,f.verticalPosition=d.verticalPosition,this.InsertBlock(f,a),this.SwapBlocks(f,d),!0}}return!1},Grid.prototype.SwapBlocks=function(a,b){"use strict";var c=a.GetCopy();a.LoadFrom(b),b.LoadFrom(c),a.SetState(Block.EState.SwappedLeft),b.SetState(Block.EState.SwappedRight)},Grid.prototype.Load=function(a){"use strict";var b,c;for(b=0;b<a.grid.length;b+=1)for(c=0;c<a.grid[b].length;c+=1){var d=new Block;d.state=a.grid[b][c].state,d.type=a.grid[b][c].type,d.verticalPosition=this.container[b].length*CONFIG.pixelPerBox,this.container[b].push(d)}},Grid.prototype.Evaluate=function(a){"use strict";var b=new GridEvaluator(a);return b.Evaluate(this.container)},Grid.prototype.BlockCount=function(){"use strict";for(var a=0,b=0;b<this.container.length;b+=1)a+=this.container[b].length-CONFIG.hiddenRowCount;return a};